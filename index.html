<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TurboTuga - Endless Runner</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="gamewrap">
  <canvas id="game" width="960" height="540"></canvas>
  <div id="hud">
    <div id="score">Score: 0</div>
    <div id="info">Token: <span id="token">9QLR3WrENnBGsv6kL33d4kDHvak71k2hBvKbHgEDwQtQ</span></div>
    <a id="buy" href="https://www.orca.so/?tokenIn=9QLR3WrENnBGsv6kL33d4kDHvak71k2hBvKbHgEDwQtQ&tokenOut=So11111111111111111111111111111111111111112" target="_blank">Comprar Token</a>
    <div id="share">Site: <a href="http://www.turbotuga.com" target="_blank">turbotuga.com</a></div>
  </div>
</div>
<script>
/* Simple endless runner built for quick deployment.
   - Place assets in same folder: mascot.png, background.png, coin.wav, jump.wav, bgm.wav
   - Upload all files to your web server and open index.html
*/

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let W = canvas.width, H = canvas.height;
let groundY = H - 80;

const loadImage = (src) => new Promise(res => { const i=new Image(); i.onload=()=>res(i); i.src=src; });

Promise.all([
  loadImage('mascot.png'),
  loadImage('background.png')
]).then(([mascotImg, bgImg]) => {
  const sounds = { 
    coin: new Audio('coin.wav'), 
    jump: new Audio('jump.wav'),
    bgm: new Audio('bgm.wav')
  };
  sounds.bgm.loop = true;
  try { sounds.bgm.play().catch(()=>{}); } catch(e){}

  // Game objects
  let player = {
    x: 140, y: groundY-64, w: 64, h: 64, vy:0, onGround:true
  };

  let speed = 4;
  let obstacles = [];
  let coins = [];
  let spawnTimer = 0;
  let coinTimer = 0;
  let score = 0;
  let high = localStorage.getItem('turbotuga_high') || 0;

  // controls
  window.addEventListener('keydown', (e) => {
    if(e.code === 'Space' || e.code === 'ArrowUp') jump();
  });
  canvas.addEventListener('pointerdown', jump);

  function jump() {
    if(player.onGround) {
      player.vy = -10;
      player.onGround = false;
      sounds.jump.currentTime = 0;
      sounds.jump.play();
    }
  }

  function spawnObstacle() {
    let h = 40 + Math.random()*40;
    obstacles.push({x: W+20, y: groundY - h, w: 30+Math.random()*30, h: h});
  }
  function spawnCoin() {
    coins.push({x: W+40, y: groundY - 120 - Math.random()*80, r:12});
  }

  function update() {
    // player physics
    player.vy += 0.5; // gravity
    player.y += player.vy;
    if(player.y >= groundY - player.h) {
      player.y = groundY - player.h;
      player.vy = 0;
      player.onGround = true;
    }

    // spawn
    spawnTimer -= 1;
    if(spawnTimer <= 0) {
      spawnTimer = 60 + Math.floor(Math.random()*80) - Math.floor(score/100);
      spawnObstacle();
    }
    coinTimer -= 1;
    if(coinTimer <= 0) {
      coinTimer = 90 + Math.floor(Math.random()*120);
      spawnCoin();
    }

    // move obstacles & coins
    for(let i=obstacles.length-1;i>=0;i--) {
      obstacles[i].x -= speed;
      if(obstacles[i].x + obstacles[i].w < -50) obstacles.splice(i,1);
      // collision with player
      if(rectIntersect(player, obstacles[i])) {
        // hit -> game over
        gameOver();
        return;
      }
    }
    for(let i=coins.length-1;i>=0;i--) {
      coins[i].x -= speed;
      if(coins[i].x < -20) coins.splice(i,1);
      else {
        if(circleRectIntersect(coins[i], player)) {
          // collect
          score += 10;
          sounds.coin.currentTime = 0;
          sounds.coin.play();
          coins.splice(i,1);
        }
      }
    }

    // increase score gradually
    score += 0.05;
    document.getElementById('score').innerText = 'Score: ' + Math.floor(score);
  }

  function rectIntersect(a,b) {
    return !(a.x+a.w < b.x || a.x > b.x+b.w || a.y+a.h < b.y || a.y > b.y+b.h);
  }
  function circleRectIntersect(c, r) {
    // closest point
    let cx = Math.max(r.x, Math.min(c.x, r.x + r.w));
    let cy = Math.max(r.y, Math.min(c.y, r.y + r.h));
    let dx = c.x - cx;
    let dy = c.y - cy;
    return (dx*dx + dy*dy) < (c.r*c.r);
  }

  let running = true;
  function gameOver() {
    running = false;
    if(Math.floor(score) > high) {
      high = Math.floor(score);
      localStorage.setItem('turbotuga_high', high);
      alert('Novo recorde! Score: ' + Math.floor(score) + '\nVocê pode ganhar um airdrop — confira no site!');
    } else {
      alert('Game Over! Score: ' + Math.floor(score));
    }
    // reset
    obstacles = []; coins = []; score = 0; running = true;
  }

  function draw() {
    // parallax background - draw cropped section
    ctx.clearRect(0,0,W,H);
    // scale bg to canvas
    ctx.drawImage(bgImg, 0, 0, W, H);
    // ground line
    ctx.fillStyle = 'rgba(0,0,0,0.15)';
    ctx.fillRect(0, groundY, W, H-groundY);
    // coins
    for(let c of coins) {
      ctx.beginPath();
      ctx.fillStyle = '#ffd700';
      ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
      ctx.fill();
      // shine
      ctx.strokeStyle = 'rgba(255,255,255,0.6)';
      ctx.stroke();
    }
    // obstacles
    for(let o of obstacles) {
      ctx.fillStyle = '#6b3b3b';
      ctx.fillRect(o.x, o.y, o.w, o.h);
      ctx.fillStyle = '#000';
      ctx.fillRect(o.x+2, o.y+2, o.w-4, o.h-4);
    }
    // player (mascot)
    ctx.save();
    ctx.drawImage(mascotImg, player.x, player.y, player.w, player.h);
    ctx.restore();
  }

  function loop() {
    if(running) {
      update();
      draw();
    }
    requestAnimationFrame(loop);
  }
  loop();

  // expose token link
  document.getElementById('buy').addEventListener('click', (e) => {
    e.preventDefault();
    window.open('https://www.orca.so/?tokenIn=9QLR3WrENnBGsv6kL33d4kDHvak71k2hBvKbHgEDwQtQ&tokenOut=So11111111111111111111111111111111111111112', '_blank');
  });

  // display high score
  const scoreDiv = document.getElementById('score');
  setInterval(()=>{ scoreDiv.innerText = 'Score: ' + Math.floor(score) + ' | High: ' + high }, 500);

});
</script>
</body>
</html>
